

{% extends 'home_index.html' %}
{% block body %}

<!-- Font Awesome for eye icons -->
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">

            <h2 class="text-center mb-4">Change Password</h2>

            <form action="/myapp/change_post/" method="post" onsubmit="return validatePassword()">
                {% csrf_token %}

                <!-- Current Password -->
                <div class="form-group mb-3">
                    <label>Current Password</label>
                    <div class="input-group">
                        <input type="password" class="form-control" name="p1" id="currentPassword"
                               placeholder="Enter current password" required>
                        <span class="input-group-text" onclick="togglePassword('currentPassword', this)">
                            <i class="fa fa-eye"></i>
                        </span>
                    </div>
                </div>

                <!-- New Password -->
                <div class="form-group mb-3">
                    <label>New Password</label>
                    <div class="input-group">
                        <input type="password" class="form-control" name="p2" id="password1"
                               placeholder="Enter new password" required>
                        <span class="input-group-text" onclick="togglePassword('password1', this)">
                            <i class="fa fa-eye"></i>
                        </span>
                    </div>
                    <small class="text-muted">
                        Minimum 8 characters, uppercase, lowercase, number & special character
                    </small>
                </div>

                <!-- Confirm Password -->
                <div class="form-group mb-3">
                    <label>Confirm Password</label>
                    <div class="input-group">
                        <input type="password" class="form-control" name="p3" id="password2"
                               placeholder="Confirm new password" required>
                        <span class="input-group-text" onclick="togglePassword('password2', this)">
                            <i class="fa fa-eye"></i>
                        </span>
                    </div>
                </div>

                <!-- Error Message -->
                <span id="errorMsg" style="color:red;font-size:15px;"></span>

                <button type="submit" class="btn btn-primary btn-block mt-3">
                    Submit
                </button>
            </form>

            {% for p in messages %}
                <div style="color:red;font-size:16px;margin-top:10px;">
                    {{ p }}
                </div>
            {% endfor %}

        </div>
    </div>
</div>

<script>
/* Password Validation */

function validatePassword() {

    const password = document.getElementById("password1").value;
    const confirmPassword = document.getElementById("password2").value;
    const errorMsg = document.getElementById("errorMsg");

    // Allow underscore (_) and common special characters
    const passwordPattern =
        /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&_])[A-Za-z\d@$!%*?&_]{8,}$/;

    if (!passwordPattern.test(password)) {
        errorMsg.innerHTML =
            "Password must be at least 8 characters and include uppercase, lowercase, number, and special character.";
        return false;
    }

    if (password !== confirmPassword) {
        errorMsg.innerHTML = "New Password and Confirm Password do not match.";
        return false;
    }

    errorMsg.innerHTML = "";
    return true;
}

{#function validatePassword() {#}
{#    const password = document.getElementById("password1").value;#}
{#    const confirmPassword = document.getElementById("password2").value;#}
{#    const errorMsg = document.getElementById("errorMsg");#}
{##}
{#    const passwordPattern =#}
{#        /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;#}
{##}
{#    if (!passwordPattern.test(password)) {#}
{#        errorMsg.innerHTML =#}
{#            "Password must be at least 8 characters and include uppercase, lowercase, number, and special character.";#}
{#        return false;#}
{#    }#}
{##}
{#    if (password !== confirmPassword) {#}
{#        errorMsg.innerHTML = "New Password and Confirm Password do not match.";#}
{#        return false;#}
{#    }#}
{##}
{#    errorMsg.innerHTML = "";#}
{#    return true;#}

/* Show / Hide Password Toggle */
function togglePassword(inputId, iconSpan) {
    const input = document.getElementById(inputId);
    const icon = iconSpan.querySelector("i");

    if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
    } else {
        input.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
    }
}
</script>

{% endblock %}

